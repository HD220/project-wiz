# Tabela Detalhada de Tarefas de Refatoração - Fase 5

Este documento rastreia o progresso da reescrita completa do código da Fase 5.

**Status:**
*   Pendente
*   Em Andamento
*   Concluído
*   Bloqueado
*   Revisão

**Complexidade:**
*   1: Muito Simples (ex: criar um VO simples, uma interface pequena)
*   2: Simples (ex: criar uma entidade pequena, um caso de uso CRUD básico)
*   3: Médio (ex: criar uma entidade mais complexa com VOs, um caso de uso com alguma lógica)
*   4: Complexo (ex: implementar um serviço com múltiplas interações, um componente de UI grande) -> Quebrar em sub-tarefas de complexidade <=2
*   5: Muito Complexo (ex: integrar um subsistema inteiro) -> Quebrar em sub-tarefas de complexidade <=2

---

| ID da Tarefa | Descrição da Tarefa                                                                                                | Status        | Dependências (IDs) | Complexidade (1-5) | Responsável | Branch Git                                 | Commit da Conclusão (Link) | Notas/Decisões                                                                                                                               |
|--------------|--------------------------------------------------------------------------------------------------------------------|---------------|--------------------|--------------------|-------------|--------------------------------------------|----------------------------|----------------------------------------------------------------------------------------------------------------------------------------------|
| **SUB-FASE 5.A: CAMADA DE DOMÍNIO (`src_refactored/core/domain/`)**                                                                |               |                    |                    |                    |             |                                            |                            |                                                                                                                                              |
| DOM-000.1    | Criar `src_refactored/shared/result.ts`                                                                            | Concluído     | -                  | 1                  | Jules       | feat/refactor-phase5-domain-project        | Link_Commit_DOM-000.1      | Result type para operações.                                                                                                                  |
| DOM-000.2    | Criar `src_refactored/core/common/value-objects/base.vo.ts` (`AbstractValueObject`)                                  | Concluído     | -                  | 1                  | Jules       | feat/refactor-phase5-domain-project        | Link_Commit_DOM-000.2      | Base para VOs com `equals`.                                                                                                                  |
| DOM-000.3    | Criar `src_refactored/core/common/value-objects/identity.vo.ts` (`Identity`)                                       | Concluído     | DOM-000.2          | 1                  | Jules       | feat/refactor-phase5-domain-project        | Link_Commit_DOM-000.3      | Base para VOs de ID (UUIDs).                                                                                                                 |
| DOM-000.4    | Criar `src_refactored/core/common/errors.ts` (`DomainError`, etc.)                                                   | Concluído     | -                  | 1                  | Jules       | feat/refactor-phase5-domain-user           | Link_Commit_DOM-000.4      | Erros customizados do domínio (DomainError, ValueError, EntityError, NotFoundError).                                                           |
|              | **Agregado de Projeto (Project & SourceCode)**                                                                     |               |                    |                    |             |                                            |                            |                                                                                                                                              |
| DOM-PROJ-001 | Criar VOs: `ProjectId`, `ProjectName`, `ProjectDescription`                                                        | Concluído     | DOM-000.2, DOM-000.3 | 1                  | Jules       | feat/refactor-phase5-domain-project        | Link_Commit_DOM-PROJ-001   | Em `core/domain/project/value-objects/`                                                                                                      |
| DOM-PROJ-002 | Criar Entidade: `Project`                                                                                          | Concluído     | DOM-PROJ-001       | 2                  | Jules       | feat/refactor-phase5-domain-project        | Link_Commit_DOM-PROJ-002   | Em `core/domain/project/project.entity.ts`                                                                                                   |
| DOM-PROJ-003 | Criar VOs: `RepositoryId`, `RepositoryPath`, `RepositoryDocsPath`                                                  | Concluído     | DOM-000.2, DOM-000.3 | 1                  | Jules       | feat/refactor-phase5-domain-project        | Link_Commit_DOM-PROJ-003   | Em `core/domain/source-code/value-objects/`                                                                                                  |
| DOM-PROJ-004 | Criar Entidade: `SourceCode`                                                                                       | Concluído     | DOM-PROJ-003, DOM-PROJ-001 (ProjectId) | 2                  | Jules       | feat/refactor-phase5-domain-project        | Link_Commit_DOM-PROJ-004   | Em `core/domain/source-code/source-code.entity.ts`                                                                                           |
| DOM-PROJ-005 | Criar Porta: `IProjectRepository`                                                                                  | Concluído     | DOM-PROJ-002       | 1                  | Jules       | feat/refactor-phase5-domain-project        | Link_Commit_DOM-PROJ-005   | Em `core/domain/project/ports/`                                                                                                              |
| DOM-PROJ-006 | Criar Porta: `ISourceCodeRepository`                                                                               | Concluído     | DOM-PROJ-004       | 1                  | Jules       | feat/refactor-phase5-domain-project        | Link_Commit_DOM-PROJ-006   | Em `core/domain/source-code/ports/`                                                                                                          |
|              | **Agregado de Configuração LLM (LLMProviderConfig)**                                                               |               |                    |                    |             |                                            |                            |                                                                                                                                              |
| DOM-LLM-001  | Criar VOs: `LLMProviderConfigId`, `LLMProviderConfigName`, `LLMProviderId`, `LLMApiKey`, `BaseUrl`                 | Concluído     | DOM-000.2, DOM-000.3 | 1                  | Jules       | feat/refactor-phase5-domain-agent-config | Link_Commit_DOM-LLM-001  | Em `core/domain/llm-provider-config/value-objects/`                                                                                          |
| DOM-LLM-002  | Criar Entidade: `LLMProviderConfig`                                                                                | Concluído     | DOM-LLM-001        | 2                  | Jules       | feat/refactor-phase5-domain-agent-config | Link_Commit_DOM-LLM-002  | Em `core/domain/llm-provider-config/llm-provider-config.entity.ts`                                                                         |
| DOM-LLM-003  | Criar Porta: `ILLMProviderConfigRepository`                                                                        | Concluído     | DOM-LLM-002        | 1                  | Jules       | feat/refactor-phase5-domain-agent-config | Link_Commit_DOM-LLM-003  | Em `core/domain/llm-provider-config/ports/`                                                                                                  |
|              | **Agregado de Agente (AgentPersonaTemplate, Agent, AgentInternalState)**                                           |               |                    |                    |             |                                            |                            |                                                                                                                                              |
| DOM-AGENT-001| Criar VOs para `AgentPersonaTemplate`: `PersonaId`, `PersonaName`, `PersonaRole`, `PersonaGoal`, `PersonaBackstory`, `ToolNames` | Concluído     | DOM-000.2, DOM-000.3 | 1                  | Jules       | feat/refactor-phase5-domain-agent-config | Link_Commit_DOM-AGENT-001| Em `core/domain/agent/value-objects/persona/`                                                                                              |
| DOM-AGENT-002| Criar Estrutura/VO: `AgentPersonaTemplate`                                                                         | Concluído     | DOM-AGENT-001      | 2                  | Jules       | feat/refactor-phase5-domain-agent-config | Link_Commit_DOM-AGENT-002| Em `core/domain/agent/agent-persona-template.vo.ts`                                                                                          |
| DOM-AGENT-003| Criar Porta: `IAgentPersonaTemplateRepository`                                                                     | Concluído     | DOM-AGENT-002      | 1                  | Jules       | feat/refactor-phase5-domain-agent-config | Link_Commit_DOM-AGENT-003| Em `core/domain/agent/ports/`                                                                                                              |
| DOM-AGENT-004| Criar VOs para `Agent`: `AgentId`, `AgentTemperature`                                                              | Concluído     | DOM-000.3          | 1                  | Jules       | feat/refactor-phase5-domain-agent-config | Link_Commit_DOM-AGENT-004| Em `core/domain/agent/value-objects/`                                                                                                      |
| DOM-AGENT-005| Criar Entidade: `Agent`                                                                                            | Concluído     | DOM-AGENT-002, DOM-AGENT-004, DOM-LLM-002 | 2            | Jules       | feat/refactor-phase5-domain-agent-config | Link_Commit_DOM-AGENT-005| Em `core/domain/agent/agent.entity.ts`                                                                                                       |
| DOM-AGENT-006| Criar Porta: `IAgentRepository`                                                                                    | Concluído     | DOM-AGENT-005      | 1                  | Jules       | feat/refactor-phase5-domain-agent-config | Link_Commit_DOM-AGENT-006| Em `core/domain/agent/ports/`                                                                                                              |
| DOM-AGENT-007| Criar VOs para `AgentInternalState`: `CurrentProjectId`, `CurrentGoal`, `GeneralNotesCollection`                   | Concluído     | DOM-000.2, DOM-000.3 | 1                  | Jules       | feat/refactor-phase5-domain-job-agent-state | Link_Commit_DOM-AGENT-007 | Em `core/domain/agent/value-objects/internal-state/`                                                                                       |
| DOM-AGENT-008| Criar Entidade: `AgentInternalState`                                                                               | Concluído     | DOM-AGENT-004, DOM-AGENT-007 | 2            | Jules       | feat/refactor-phase5-domain-job-agent-state | Link_Commit_DOM-AGENT-008 | Em `core/domain/agent/agent-internal-state.entity.ts`                                                                                      |
| DOM-AGENT-009| Criar Porta: `IAgentInternalStateRepository`                                                                       | Concluído     | DOM-AGENT-008      | 1                  | Jules       | feat/refactor-phase5-domain-job-agent-state | Link_Commit_DOM-AGENT-009 | Em `core/domain/agent/ports/`                                                                                                              |
|              | **Agregado de Job (Job & ActivityContext)**                                                                        |               |                    |                    |             |                                            |                            |                                                                                                                                              |
| DOM-JOB-001  | Criar VOs para `Job`: `JobId`, `JobName`, `JobStatus`, `JobPriority`, `JobTimestamp`, `AttemptCount`, `MaxAttempts`| Concluído     | DOM-000.2, DOM-000.3 | 1                  | Jules       | feat/refactor-phase5-domain-job-agent-state | Link_Commit_DOM-JOB-001  | Em `core/domain/job/value-objects/`                                                                                                          |
| DOM-JOB-002  | Criar VOs para `RetryPolicy`: `RetryPolicy`, `NoRetryPolicy`, `BackoffType`, `RetryDelay`                          | Concluído     | DOM-JOB-001 (MaxAttempts) | 1             | Jules       | feat/refactor-phase5-domain-job-agent-state | Link_Commit_DOM-JOB-002  | Em `core/domain/job/value-objects/`                                                                                                          |
| DOM-JOB-003  | Criar VOs para `ActivityContext` (parte 1): `ActivityType`, `HistoryEntryRoleType`, `EntryContent`, `HistoryEntryRole`, `ActivityHistoryEntry` | Concluído     | DOM-000.2, DOM-JOB-001 (JobTimestamp) | 2 | Jules   | feat/refactor-phase5-domain-job-agent-state | Link_Commit_DOM-JOB-003  | Em `core/domain/job/value-objects/` e `context-parts/`                                                                                       |
| DOM-JOB-004  | Criar Coleções de Primeira Classe para `ActivityContext`: `ActivityHistory`, `ActivityNotes`                        | Concluído     | DOM-JOB-003        | 2                  | Jules       | feat/refactor-phase5-domain-job-agent-state | Link_Commit_DOM-JOB-004  | Em `core/domain/job/value-objects/`                                                                                                          |
| DOM-JOB-005  | Criar VOs para `ActivityContext` (parte 2 - context-parts): `MessageContent`, `Sender`, `ToolName`, `GoalToPlan`, `PlannedStepsCollection`, `ValidationCriteriaCollection`, `ValidationStatus` | Concluído | DOM-000.2          | 2       | Jules       | feat/refactor-phase5-domain-job-agent-state | Link_Commit_DOM-JOB-005  | Em `core/domain/job/value-objects/context-parts/`                                                                                            |
| DOM-JOB-006  | Criar VOs para `Job` (coleções): `JobDependsOn`, `RelatedActivityIds`                                              | Concluído     | DOM-JOB-001 (JobId)| 1                  | Jules       | feat/refactor-phase5-domain-job-agent-state | Link_Commit_DOM-JOB-006  | Em `core/domain/job/value-objects/`                                                                                                          |
| DOM-JOB-007  | Criar VO: `TargetAgentRole`                                                                                        | Concluído     | DOM-000.2          | 1                  | Jules       | feat/refactor-phase5-domain-job-agent-state | Link_Commit_DOM-JOB-007  | Em `core/domain/job/value-objects/`                                                                                                          |
| DOM-JOB-008  | Criar VO Composto: `ActivityContext`                                                                               | Concluído     | DOM-JOB-003, DOM-JOB-004, DOM-JOB-005 | 2       | Jules       | feat/refactor-phase5-domain-job-agent-state | Link_Commit_DOM-JOB-008  | Em `core/domain/job/value-objects/activity-context.vo.ts`                                                                                    |
| DOM-JOB-009  | Criar Tipos Compartilhados: `job-processing.types.ts` (`AgentJobState`, `ExecutionHistoryEntry`, `AgentExecutorResult`) | Concluído     | DOM-JOB-004        | 1                  | Jules       | feat/refactor-phase5-domain-job-agent-state | Link_Commit_DOM-JOB-009  | Em `core/domain/job/`                                                                                                                        |
| DOM-JOB-010  | Criar Entidade: `Job`                                                                                              | Concluído     | DOM-JOB-001 to DOM-JOB-009 | 3       | Jules       | feat/refactor-phase5-domain-job-agent-state | Link_Commit_DOM-JOB-010  | Em `core/domain/job/job.entity.ts`. Inclui `data` para `AgentJobState`.                                                                      |
| DOM-JOB-011  | Criar Porta: `IJobRepository`                                                                                      | Concluído     | DOM-JOB-010        | 1                  | Jules       | feat/refactor-phase5-domain-job-agent-state | Link_Commit_DOM-JOB-011  | Em `core/domain/job/ports/`                                                                                                                  |
|              | **Outras Entidades de Domínio**                                                                                    |               |                    |                    |             |                                            |                            |                                                                                                                                              |
| DOM-USER-001 | Criar VOs e Entidade `User`, Porta `IUserRepository`                                                               | Concluído     | DOM-000.3, DOM-000.4 | 2                  | Jules       | feat/refactor-phase5-domain-user           | Link_Commit_DOM-USER-001   | VOs: UserId, UserNickname, UserUsername, UserEmail, UserAvatar. Entity: User. Port: IUserRepository. Base AbstractEntity criada.             |
| DOM-ANNO-001 | Criar VOs e Entidade `Annotation`, Porta `IAnnotationRepository`                                                   | Concluído     | DOM-000.3, DOM-000.4 | 2                  | Jules       | feat/refactor-phase5-domain-annotation     | Link_Commit_DOM-ANNO-001   | VOs: AnnotationId, AnnotationText. Entity: Annotation. Port: IAnnotationRepository.                                                          |
| DOM-MEM-001  | Criar VOs e Entidade `MemoryItem`, Porta `IMemoryRepository`                                                       | Concluído     | DOM-000.3, DOM-000.4 | 2                  | Jules       | feat/refactor-phase5-domain-memoryitem     | Link_Commit_DOM-MEM-001    | VOs: MemoryItemId, MemoryItemContent, MemoryItemTags, MemoryItemSource, MemoryItemEmbedding. Entity: MemoryItem. Port: IMemoryRepository.       |
| DOM-QUEUE-001| Criar Entidade `Queue` (metadados da fila, ex: `name`, `concurrency`), VOs, Porta `IQueueMetadataRepository` (nome sugerido) | Concluído     | DOM-000.3, DOM-000.4 | 2                  | Jules       | feat/refactor-phase5-domain-queue          | Link_Commit_DOM-QUEUE-001  | VOs: QueueId, QueueName, QueueConcurrency, QueueDescription. Entity: Queue. Port: IQueueMetadataRepository.                                  |
|              | **Interfaces de Ferramentas (Tools)**                                                                              |               |                    |                    |             |                                            |                            |                                                                                                                                              |
| DOM-TOOL-001 | Criar `IAgentTool` interface em `src_refactored/core/tools/tool.interface.ts`                                      | Concluído     | -                  | 1                  | Jules       | feat/refactor-phase5-domain-iagenttool     | Link_Commit_DOM-TOOL-001   | Definida IAgentTool<InputSchema, TOutput>, IToolExecutionContext, e ToolError. Alinhada com Zod e GenericAgentExecutor.                        |
| ---          | ---                                                                                                                | ---           | ---                | ---                | ---         | ---                                        | ---                        | ---                                                                                                                                          |
| **SUB-FASE 5.B: CAMADA DE APLICAÇÃO (`src_refactored/core/application/`)**                                                         |               |                    |                    |                    |             |                                            |                            |                                                                                                                                              |
| APP-COMMON-001| Criar `src_refactored/core/application/common/executable.ts` (`Executable` interface)                            | Concluído     | -                  | 1                  | Jules       | feat/refactor-phase5-app-executable        | Link_Commit_APP-COMMON-001 | Interface Executable<InputType, SuccessData, ErrorType> definida.                                                                            |
|              | **Portas para Adaptadores de Infraestrutura**                                                                      |               |                    |                    |             |                                            |                            |                                                                                                                                              |
| APP-PORT-001 | Criar `IFileSystem` em `core/ports/adapters/`                                                                      | Concluído     | -                  | 1                  | Jules       | feat/refactor-phase5-usecase-create-project | Link_Commit_APP-PORT-001 |                                                                                                                                              |
| APP-PORT-002 | Criar `IVersionControlSystem` em `core/ports/adapters/`                                                            | Concluído     | -                  | 1                  | Jules       | feat/refactor-phase5-usecase-create-project | Link_Commit_APP-PORT-002 |                                                                                                                                              |
| APP-PORT-003 | Criar `IJobQueue` (para enfileirar/obter jobs) em `core/ports/adapters/`                                           | Concluído     | DOM-JOB-010        | 1                  | Jules       | feat/refactor-phase5-app-ijobqueue         | Link_Commit_APP-PORT-003   | Interface IJobQueue e QueueError definidas.                                                                                                  |
| APP-PORT-004 | Criar `ILLMAdapter` em `core/ports/adapters/` (ou `core/application/ports/`)                                      | Pendente      | -                  | 1                  | Jules       |                                            |                            |                                                                                                                                              |
|              | **Casos de Uso**                                                                                                   |               |                    |                    |             |                                            |                            |                                                                                                                                              |
| APP-PROJ-001 | Implementar `CreateProjectUseCase` (schemas Zod, lógica)                                                           | Concluído     | DOM-PROJ-006, APP-PORT-001, APP-PORT-002 | 3 | Jules | feat/refactor-phase5-usecase-create-project | Link_Commit_APP-PROJ-001 |                                                                                                                                              |
| APP-PROJ-002 | Implementar `ListProjectsUseCase`                                                                                  | Pendente      | DOM-PROJ-005       | 2                  | Jules       |                                            |                            |                                                                                                                                              |
| APP-PROJ-003 | Implementar `GetProjectDetailsUseCase`                                                                             | Pendente      | DOM-PROJ-005, DOM-PROJ-006 | 2        | Jules       |                                            |                            |                                                                                                                                              |
| APP-LLMC-001 | Implementar `CreateLLMProviderConfigUseCase`                                                                       | Pendente      | DOM-LLM-003        | 2                  | Jules       |                                            |                            |                                                                                                                                              |
| APP-PTPL-001 | Implementar `CreatePersonaTemplateUseCase`                                                                         | Pendente      | DOM-AGENT-003      | 2                  | Jules       |                                            |                            |                                                                                                                                              |
| APP-AGENT-001| Implementar `CreateAgentUseCase`                                                                                   | Pendente      | DOM-AGENT-006, DOM-AGENT-003, DOM-LLM-003 | 2 | Jules   |                                            |                            |                                                                                                                                              |
| APP-AGST-001 | Implementar `SaveAgentInternalStateUseCase`, `LoadAgentInternalStateUseCase`                                       | Pendente      | DOM-AGENT-009      | 2                  | Jules       |                                            |                            |                                                                                                                                              |
| APP-JOB-001  | Implementar `CreateJobUseCase`                                                                                     | Pendente      | DOM-JOB-011, APP-PORT-003 | 3            | Jules       |                                            |                            |                                                                                                                                              |
| APP-JOB-002  | Implementar `UpdateJobUseCase`, `CancelJobUseCase`, `RetryJobUseCase`, `ListJobsUseCase`                           | Pendente      | DOM-JOB-011, APP-PORT-003 | 3            | Jules       |                                            |                            |                                                                                                                                              |
| APP-ANNO-001 | Adaptar/Reimplementar UseCases de Annotation (List, Save, Remove)                                                  | Pendente      | DOM-ANNO-001       | 2                  | Jules       |                                            |                            |                                                                                                                                              |
| APP-MEM-001  | Adaptar/Reimplementar UseCases de Memory (Save, Search, Remove, SearchSimilar)                                     | Pendente      | DOM-MEM-001        | 3                  | Jules       |                                            |                            |                                                                                                                                              |
|              | **Serviços de Aplicação**                                                                                          |               |                    |                    |             |                                            |                            |                                                                                                                                              |
| APP-SVC-001  | Implementar `GenericAgentExecutor` (como `IAgentExecutor`)                                                         | Pendente      | DOM-AGENT-005, DOM-JOB-010, APP-PORT-004, DOM-TOOL-001 | 4 | Jules |                                            |                            | Quebrar em sub-tarefas (init, loop LLM, tool call, history mgmt, error handling, re-plan).                                                  |
| APP-SVC-002  | Implementar `WorkerService`                                                                                        | Pendente      | DOM-JOB-011, APP-SVC-001, APP-PORT-003 | 3       | Jules       |                                            |                            |                                                                                                                                              |
| ---          | ---                                                                                                                | ---           | ---                | ---                | ---         | ---                                        | ---                        | ---                                                                                                                                          |
| **SUB-FASE 5.C: CAMADA DE INFRAESTRUTURA (`src_refactored/infrastructure/`)**                                                      |               |                    |                    |                    |             |                                            |                            |                                                                                                                                              |
| ...          | (Repositórios Drizzle, Adaptadores de Tools, LLM, Fila, Worker Pool, IOC InversifyJS, Config)                       | Pendente      | ...                | ...                | Jules       |                                            |                            | Detalhar conforme progresso.                                                                                                                 |
| ---          | ---                                                                                                                | ---           | ---                | ---                | ---         | ---                                        | ---                        | ---                                                                                                                                          |
| **SUB-FASE 5.D: CAMADA DE APRESENTAÇÃO (UI e Electron)**                                                                           |               |                    |                    |                    |             |                                            |                            |                                                                                                                                              |
| ...          | (Electron Main/Preload, Handlers IPC, Componentes React UI, Páginas, Stores, Hooks, Serviços IPC)                  | Pendente      | ...                | ...                | Jules       |                                            |                            | Detalhar conforme progresso.                                                                                                                 |
| ---          | ---                                                                                                                | ---           | ---                | ---                | ---         | ---                                        | ---                        | ---                                                                                                                                          |
| **SUB-FASE 5.E: TESTES**                                                                                                           |               |                    |                    |                    |             |                                            |                            |                                                                                                                                              |
| ...          | (Testes Unitários, de Integração, E2E)                                                                             | Pendente      | ...                | ...                | Jules       |                                            |                            | Detalhar conforme progresso.                                                                                                                 |
| ---          | ---                                                                                                                | ---           | ---                | ---                | ---         | ---                                        | ---                        | ---                                                                                                                                          |
| **SUB-FASE 5.F: REMOÇÃO DE CÓDIGO LEGADO E MIGRAÇÃO**                                                                              |               |                    |                    |                    |             |                                            |                            |                                                                                                                                              |
| ...          | (Análise de `src/`, `src2/`, Exclusão, Movimentação de `src_refactored/` para `src/`, Ajustes finais)               | Pendente      | Todas anteriores   | ...                | Jules       |                                            |                            |                                                                                                                                              |
---
