name: Documentation Monitoring Dashboard
on:
  schedule:
    - cron: '0 0 * * *' # Executa diariamente à meia-noite
  workflow_dispatch: # Permite execução manual

jobs:
  update-dashboard:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install dependencies
        run: npm install

      - name: Run documentation metrics collector
        run: |
          # Script para coletar métricas
          echo "Calculating documentation metrics..."
          TEMPLATE_ADOPTION=$(find docs/ -type f | grep -c '/templates/')
          ADR_COMPLIANCE=$(grep -r "Status: Implementado" docs/adr/ | wc -l)
          
          # Gerar novo conteúdo do dashboard
          echo "# Documentation Monitoring Dashboard" > docs/dashboards/documentation-monitoring.md
          echo "**Last updated:** $(date)" >> docs/dashboards/documentation-monitoring.md
          echo "" >> docs/dashboards/documentation-monitoring.md
          echo "## Metrics" >> docs/dashboards/documentation-monitoring.md
          echo "- **Template Adoption:** $TEMPLATE_ADOPTION templates in use" >> docs/dashboards/documentation-monitoring.md
          echo "- **ADR Compliance:** $ADR_COMPLIANCE ADRs implemented" >> docs/dashboards/documentation-monitoring.md
          echo "" >> docs/dashboards/documentation-monitoring.md
          echo "## Historical Data" >> docs/dashboards/documentation-monitoring.md
          echo "| Date | Templates | ADRs |" >> docs/dashboards/documentation-monitoring.md
          echo "|------|-----------|------|" >> docs/dashboards/documentation-monitoring.md
          echo "| $(date) | $TEMPLATE_ADOPTION | $ADR_COMPLIANCE |" >> docs/dashboards/documentation-monitoring.md

      - name: Commit and push changes
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          git add docs/dashboards/documentation-monitoring.md
          git commit -m "Update documentation monitoring dashboard [skip ci]"
          git push