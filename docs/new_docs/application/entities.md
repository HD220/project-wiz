# Application Entities

This document outlines the main data entities within Project Wiz, representing the core components of its autonomous software development factory.

## Core Entities

-   **Project:**
    -   **Purpose:** Represents a distinct software development project managed within the Project Wiz application. It serves as a container for all related work, configurations, and collaborations.
    -   **Key Attributes/Data:**
        -   A unique identifier for the project.
        -   The name of the project.
        -   A general description of the project's goals and scope.
        -   Information about associated code repositories (e.g., Git URLs).
        -   A list of human users and AI Personas who are members of or assigned to the project.

-   **Persona (Agent):**
    -   **Purpose:** A Persona defines the configuration (role, goals, backstory, specific LLM settings, enabled Tools) that shapes how an underlying Large Language Model (LLM) will behave and interact to perform tasks. It's the "personality" and operational guide for the AI.
    -   **Key Attributes/Data:**
        -   A unique identifier for the Persona configuration.
        -   **Name, Role, Goals, Backstory:** These attributes are primarily used to construct the system prompt and initial instructions given to the LLM, guiding its responses and task execution style.
        -   **LLM Configuration:** Specific model choice (e.g., OpenAI GPT-4, DeepSeek Coder), parameters (temperature, max tokens), and API keys.
        -   **Enabled Tools:** A list of pre-developed `Tools` that this Persona is authorized to use. These Tools are described to the LLM (often via the AI SDK used for integration), allowing it to request their execution.

-   **Job (Activity):**
    -   **Purpose:** Represents a unit of work, a task, or a specific activity assigned to be executed by an Agent (which uses a Persona configuration). Jobs are the fundamental operational items managed and processed by the system.
    -   **Key Attributes/Data:**
        -   A unique identifier for the Job.
        -   Type/Name: Categorizes the Job (e.g., "GenerateCode", "RunTests", "AnalyzeIssue").
        -   Description: Detailed explanation of what the Job entails.
        -   Status: Current state (e.g., pending, executing, finished, failed, waiting, delayed).
        -   Priority: While a base priority might be set, it's often dynamically managed or influenced by the Agent/LLM based on context and dependencies.
        -   Input Data/Payload: Data/parameters for the Persona to start the Job.
        -   Reference to ActivityContext Data: Link to its specific `ActivityContext`.
        -   Output/Result Data: Information/artifacts generated.
        -   Creation/Update Timestamps.
        -   Max Attempts, Current Attempts for retries.
        -   `depends_on_job_ids`: A list of other Job IDs that must be completed before this Job can start, enabling dependency management.
        -   `parent_job_id`: An identifier for a parent Job, if this Job is part of a larger, hierarchical task decomposition.

-   **ActivityContext:**
    -   **Purpose:** Holds specific, dynamic contextual information for a single, active Job instance being processed by an Agent. It guides the LLM (via the Persona configuration) in its execution flow and decision-making for that Job. This context is continuously updated as the Job progresses.
    -   **Key Attributes/Data:**
        -   Initial message/instruction that defined or triggered the Job.
        -   Sender/originator details.
        -   Current specific goal for this instance of the Job.
        -   History of interactions/messages related to this Job (e.g., a sequence of `CoreMessages` if using an AI SDK like Vercel AI SDK), forming the conversational memory for the LLM.
        -   Planned steps or sub-tasks (often generated by the LLM during initial planning).
        -   Notes, observations, or intermediate results recorded by the Agent/LLM.
        -   `validationCriteria`: The "Definition of Done" for the Job, often defined by the Agent/LLM during its planning phase, outlining what success looks like.
        -   `validationResult`: The outcome of the Agent/LLM's self-validation against the `validationCriteria`.
        -   Annotations or key information from this Job that might be deemed important enough by the Agent to be promoted to its `AgentInternalState` for longer-term recall.

-   **AgentInternalState:**
    -   **Purpose:** Represents the persistent, medium to long-term memory and evolving state of an Agent (the underlying logic that utilizes a Persona configuration). This allows an Agent to maintain continuity, learn from past interactions across multiple Jobs, and apply broader context to its tasks.
    -   **Key Attributes/Data:**
        -   Agent ID it belongs to.
        -   Current Project ID and/or Issue ID the Agent might be focused on.
        -   Overall current high-level goal or directive for the Agent.
        -   A list or reference to all `Activities` (Jobs) managed or processed by this Agent, allowing it to understand its own workload and history.
        -   A collection of "promises" or commitments made by the Agent (to the user or other Agents).
        -   General notes, accumulated knowledge, and distilled insights (learnings) gathered by the Agent from previous `ActivityContexts` or direct interactions.
        -   This state provides continuous context to the Agent, differentiating it from the per-Job `ActivityContext`.

-   **Tool:**
    -   **Purpose:** A specific, pre-developed function or capability within the Project Wiz source code that an Agent (via its LLM) can request to be executed to perform tasks or interact with its environment.
    -   **Key Attributes/Data:**
        -   Name of the Tool (e.g., `ReadFileTool`, `CommitToGitRepoTool`, `SendMessageToAgentTool`, `PostToProjectChannelTool`).
        -   Description of its capabilities, input parameters, and expected output format (this information is typically provided to the LLM via an AI SDK so it knows how and when to use the Tool).
        -   The actual code implementing the Tool's logic.

-   **Task:**
    -   **Purpose:** Represents a specific objective or a focused prompt that the Agent's internal logic directs to the LLM (configured by the Persona). The LLM then attempts to achieve this `Task`, often by planning and utilizing available `Tools`. A `Task` is not a pre-coded sequence of `Tools`, but rather the goal the LLM works towards.
    -   **Key Attributes/Data:**
        -   Description of the objective or problem to be solved.
        -   Input context (derived from `ActivityContext` and `AgentInternalState`).
        -   Constraints or specific instructions for the LLM.

-   **User:**
    -   **Purpose:** Represents a human user who interacts with the Project Wiz application.
    -   **Key Attributes/Data:**
        -   User ID, Name, Profile Information.

## Conceptual Entities

These entities describe key functional aspects of the system rather than direct data models that are frequently persisted in the same way as the core entities.

-   **Queue (Job Queue):**
    -   **Purpose:** Manages the lifecycle of Jobs, inspired by robust systems like BullMQ.
    -   **Function:** Provides reliable Job queuing with features such as:
        -   Persistence of Jobs (e.g., using SQLite via Drizzle ORM).
        -   Management of Job dependencies (`depends_on_job_ids`).
        -   Priority management (though actual priority can be dynamically influenced by Agents interacting with their own Jobs via Tools).
        -   Support for retentativas (retries) with configurable backoff strategies.
        -   Job scheduling or delayed execution.
        -   Emitting events related to Job status changes, allowing other parts of the system (like the UI or an Agent) to react.
        -   Ensures Jobs are picked up by available Agents for processing.

-   **Worker (Agent's Execution Loop):**
    -   **Purpose:** Conceptually, a "Worker" in Project Wiz represents the individual, asynchronous processing loop of a single Agent. Each Agent effectively acts as its own worker for the Jobs assigned to it.
    -   **Function:** An Agent (as a Worker) fetches its next Job/Task from its internal representation of its queue (which is sourced from the main `Queue`), loads the necessary context (`AgentInternalState`, `ActivityContext`), and processes it sequentially. System-level concurrency is achieved by having multiple distinct Agents operating simultaneously, each with their own asynchronous loop, rather than a single Job being parallelized across multiple traditional worker threads.
